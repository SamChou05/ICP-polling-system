import { IDL } from '@dfinity/candid';
import { EncodeVisitor } from 'azle/src/lib/candid/serde/visitors/encode_visitor';
import { AzleResult } from 'azle/src/lib/system_types';
import { DecodeVisitor } from 'azle/src/lib/candid/serde/visitors/decode_visitor';
import { VisitorData, VisitorResult } from 'azle/src/lib/candid/serde/visitors/types';
import { visitAzleVariant } from 'azle/src/lib/candid/serde/visitors/visit/variant/azle_variant';
import { visitAzleResult } from 'azle/src/lib/candid/serde/visitors/visit/variant/azle_result';

export function visitVariant(
    visitor: DecodeVisitor | EncodeVisitor,
    fields: [string, IDL.Type<any>][],
    data: VisitorData
): VisitorResult {
    if (data.candidType instanceof AzleResult) {
        return visitAzleResult(visitor, fields, data);
    }
    return visitAzleVariant(visitor, fields, data);
}
