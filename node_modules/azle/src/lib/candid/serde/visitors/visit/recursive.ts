import { IDL } from '@dfinity/candid';
import { EncodeVisitor } from 'azle/src/lib/candid/serde/visitors/encode_visitor';
import { DecodeVisitor } from 'azle/src/lib/candid/serde/visitors/decode_visitor';
import { VisitorData, VisitorResult } from 'azle/src/lib/candid/serde/visitors/types';

export function visitRec<T>(
    visitor: DecodeVisitor | EncodeVisitor,
    ty: IDL.ConstructType<T>,
    data: VisitorData
): VisitorResult {
    let candidType = data.candidType();
    if (candidType.isCanister) {
        candidType = candidType([]);
    }
    return ty.accept(visitor, {
        ...data,
        candidType
    });
}
